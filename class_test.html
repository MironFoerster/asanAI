<!DOCTYPE html>
<html>
	<head>
		<title>asanai.js</title>
		<script src='asanai.js' crossorigin></script>
		<script src='tf/tf.min.js' crossorigin></script>
		<script src='libs/jquery.js' crossorigin></script>
		<script src='libs/plotly-latest.min.js' crossorigin></script>
	</head>
	<body>
		<pre id="memory"></pre>
		<pre>====</pre>
		<div id="test_images"></div>
		<pre>====</pre>
		<img id="test_image" src="_gui/logo.png" width=50 height=50 />
		<pre id="test_image_prediction"></pre>
		<pre id="summary_pre"></pre>
		<button onclick="asanai.toggle_webcam(this)">Stop webcam</button>
		<div id="webcam_prediction"></div>
		<div id="internal_states"></div>
		<div id="fcnn_div"></div>

		<script>
			var optimizer_config = { optimizer: "adam", loss: "categoricalCrossentropy" }
			var asanai;

			$(document).ready(function() {
				var model_data = [
					{conv2d: {filters: 4, kernelSize: [3, 3], inputShape: [20, 20, 3], activation: "relu", kernelInitializer: "glorotUniform"}},
					{conv2d: {filters: 4, kernelSize: [3, 3], activation: "relu", biasInitializer: "ones"}},
					{flatten: {}},
					{dense: {units: 5, activation: "relu"}},
					{dense: {units: 4, activation: "softmax"}}
				];


				asanai = new asanAI({model_data: model_data, optimizer_config: optimizer_config});

				asanai.set_divide_by(255);

				asanai.set_labels(["a", "b", "c", "d"]);

				asanai.show_internals("internal_states");
				//asanai.hide_internals();

				asanai.show_and_predict_webcam_in_div("webcam_prediction");

				asanai.predict_image("test_image", "test_image_prediction");

				asanai.draw_fcnn("fcnn_div");

				asanai.write_model_summary("summary_pre")

				asanai.write_tensors_info("memory");
			});

			function test_model_switch () {
				var fl = tf.layers.dense({units: 3, activation: "softmax", inputShape: [20, 20, 3]}); 
				var xxx = tf.sequential({layers: [fl]}); 
				xxx.compile(optimizer_config); 
				asanai.set_model(xxx)
			}

			function test_model_switch_two () {
				var new_model_struct = [
					{conv2d: {filters: 4, kernelSize: [3, 3], inputShape: [20, 20, 3], activation: "relu"}},
					{conv2d: {filters: 4, kernelSize: [3, 3], activation: "relu"}},
					{conv2d: {filters: 4, kernelSize: [3, 3], activation: "relu"}},
					{conv2d: {filters: 4, kernelSize: [3, 3], activation: "relu"}},
					{conv2d: {filters: 4, kernelSize: [3, 3], activation: "relu"}},
					{conv2d: {filters: 4, kernelSize: [3, 3], activation: "relu"}},
					{flatten: {}},
					{dense: {units: 5, activation: "relu"}},
					{dense: {units: 4, activation: "softmax"}}
				];

				asanai.create_model_from_model_data(new_model_struct, optimizer_config);
			}

			function test_model_switch_three () {
				var new_model_struct = [
					{dense: {units: 5, activation: "relu", inputShape: [5]}},
					{dense: {units: 4, activation: "softmax"}}
				];

				asanai.create_model_from_model_data(new_model_struct, optimizer_config);
			}

			function load_test_images () {
				var xxx = asanai.load_image_urls_to_div_and_tensor("test_images", [
					["traindata/signs/example/a_fire.png", "fire"]
					["traindata/signs/example/b_mandatory.png", "fire"]
					["traindata/signs/example/c_prohibition.png", "fire"]
					["traindata/signs/example/d_rescue.png", "fire"]
					["traindata/signs/example/e_warning.png", "fire"]
				], 1);

				console.log(xxx);
			}
		</script>
	</body>
</html>
